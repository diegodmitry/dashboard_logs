# Log Dashboard

Dashboard de logs com backend Node.js/Express e frontend React para visualiza√ß√£o de estat√≠sticas de logs.

## üöÄ Funcionalidades

- **Backend**: API REST com Node.js, Express e TypeScript
- **Frontend**: Dashboard React com gr√°ficos Plotly
- **Banco**: MongoDB com TTL de 10 dias
- **SSH**: Fetch remoto de logs via SSH
- **Docker**: Containeriza√ß√£o completa com Docker Compose

## üìã Pr√©-requisitos

- Docker e Docker Compose
- Node.js 18+ (para desenvolvimento local)
- MongoDB (opcional para desenvolvimento local)

## üì∏ Screenshots

> **üí° Screenshots do Dashboard em funcionamento**

![Dashboard Principal](screenshots/dashboard-main.png)
*Dashboard principal com os tr√™s gr√°ficos principais*

![Top Errors](screenshots/top-errors.png)
*Gr√°fico de barras dos erros mais frequentes*

![Time Series](screenshots/time-series.png)
*S√©rie temporal com zoom e interatividade*

![Levels Distribution](screenshots/levels-distribution.png)
*Distribui√ß√£o por n√≠veis de log*

## üõ†Ô∏è Instala√ß√£o

### 1. Clone o reposit√≥rio
```bash
git clone <repository-url>
cd log-dashboard
```

### 2. Configure as vari√°veis de ambiente

**Backend** (`backend/env.example` ‚Üí `backend/.env`):
```env
MONGO_URI=mongodb://mongo:27017/log-dashboard
PORT=3000
NODE_ENV=development
SSH_HOST=your-remote-server.com
SSH_USER=your-username
SSH_PORT=22
SSH_KEY_PATH=/path/to/your/private/key
SSH_TIMEOUT=15000
LOG_LEVEL=info
```

**‚ö†Ô∏è Importante para SSH**: Se o servidor SSH usar algoritmos legados (ssh-rsa), configure:
```bash
# Op√ß√£o 1: Arquivo de configura√ß√£o SSH
cp backend/ssh_config ~/.ssh/config

# Op√ß√£o 2: Vari√°veis de ambiente
export SSH_OPTS="HostKeyAlgorithms=+ssh-rsa,PubkeyAcceptedAlgorithms=+ssh-rsa"
```

**Frontend** (`frontend/env.example` ‚Üí `frontend/.env`):
```env
VITE_API_URL=http://localhost:3000
```

### 3. Execute com Docker Compose
```bash
cd docker
docker compose up -d
```

### 4. Teste r√°pido
```bash
# Verificar se tudo est√° funcionando
curl http://localhost:3000/health

# Popular com dados de exemplo
docker compose exec api npm run seed:logs

# Verificar dados no MongoDB
docker compose exec mongo mongosh log-dashboard --eval "db.logs.countDocuments()"
```

## üèÉ‚Äç‚ôÇÔ∏è Uso

### URLs de Acesso
- **Dashboard**: http://localhost:5173
- **API**: http://localhost:3000
- **MongoDB Express**: http://localhost:8081 (admin/admin123)

### Comandos √öteis

```bash
# Ver logs dos containers
docker compose logs -f

# Parar todos os servi√ßos
docker compose down

# Rebuild das imagens
docker compose up -d --build

# Acessar MongoDB
docker compose exec mongo mongosh log-dashboard

# Executar scripts do backend
docker compose exec api npm run seed:logs
docker compose exec api npm run ingest

# Ver logs espec√≠ficos
docker compose logs api
docker compose logs web
docker compose logs mongo

# Acessar container
docker compose exec api sh
docker compose exec mongo mongosh log-dashboard

# Executar testes
docker compose exec api npm test
```

## üß™ Testes e Dados Fict√≠cios

### üìã Para Iniciantes - Passo a Passo Completo

**Objetivo**: Ver o dashboard funcionando com dados de exemplo em 5 minutos.

#### Passo 1: Verificar se o projeto est√° rodando
Abra o terminal e digite:
```bash
# Verificar se os containers est√£o rodando
docker compose ps
```
**O que voc√™ deve ver**: 3 containers (mongo, api, web) com status "Up"

#### Passo 2: Popular com dados fict√≠cios
```bash
# Popular com ~1000 logs de exemplo
docker compose exec api npm run seed:logs
```
**O que voc√™ deve ver**: Mensagens como "Criando logs fict√≠cios..." e "Logs criados com sucesso!"

#### Passo 3: Verificar se os dados foram criados
```bash
# Contar quantos logs foram criados
docker compose exec mongo mongosh log-dashboard --eval "db.logs.countDocuments()"
```
**O que voc√™ deve ver**: Um n√∫mero como "1000" (aproximadamente)

#### Passo 4: Abrir o Dashboard no navegador
1. Abra seu navegador (Chrome, Firefox, Safari)
2. Digite na barra de endere√ßos: `http://localhost:5173`
3. Pressione Enter

**O que voc√™ deve ver**: Uma p√°gina com 3 gr√°ficos coloridos

#### Passo 5: Testar os gr√°ficos
1. **Gr√°fico de Barras (Top Errors)**: Deve mostrar barras coloridas com nomes de erros
2. **Gr√°fico de Pizza (Levels Distribution)**: Deve mostrar um c√≠rculo dividido em fatias coloridas
3. **Gr√°fico de Linha (Time Series)**: Deve mostrar uma linha com pontos ao longo do tempo

#### Passo 6: Testar os filtros
1. Clique nos bot√µes "√öltima Hora", "√öltimo Dia", "√öltima Semana"
2. **O que deve acontecer**: Os gr√°ficos devem atualizar automaticamente
3. No gr√°fico de linha, mude o seletor de "hour" para "day"
4. **O que deve acontecer**: A linha deve ficar mais suave

### üéØ O que voc√™ deve ver no Dashboard

**Se tudo estiver funcionando, voc√™ ver√°:**

1. **Cabe√ßalho**: "Log Dashboard" com status "Sistema funcionando"
2. **Controles**: Bot√µes de per√≠odo e seletor de agrupamento
3. **3 Gr√°ficos**:
   - **Top Errors**: Barras mostrando erros como "Database connection failed"
   - **Levels Distribution**: Pizza com fatias para "error", "warn", "info", "debug"
   - **Time Series**: Linha mostrando evolu√ß√£o dos logs ao longo do tempo

### üîç Verificando se os dados est√£o corretos

**Para ver uma amostra dos dados criados:**
```bash
# Ver 3 exemplos de logs criados
docker compose exec mongo mongosh log-dashboard --eval "db.logs.find().limit(3).pretty()"
```

**O que voc√™ deve ver**: 3 blocos de texto com informa√ß√µes como:
- `timestamp`: Data e hora
- `level`: "error", "warn", "info" ou "debug"
- `message`: Descri√ß√£o do log
- `source`: "api-server" ou similar

### üö® Problemas Comuns para Iniciantes

#### "N√£o consigo ver os gr√°ficos"
**Poss√≠veis causas:**
1. **Dados n√£o foram criados**: Execute novamente `docker compose exec api npm run seed:logs`
2. **API n√£o est√° funcionando**: Verifique se `curl http://localhost:3000/health` retorna "OK"
3. **Navegador n√£o carrega**: Tente `http://localhost:5173` em outro navegador

#### "Os gr√°ficos est√£o vazios"
**Solu√ß√£o:**
```bash
# Verificar se h√° dados
docker compose exec mongo mongosh log-dashboard --eval "db.logs.countDocuments()"

# Se retornar 0, criar dados novamente
docker compose exec api npm run seed:logs
```

#### "Erro de conex√£o no navegador"
**Verifica√ß√µes:**
1. Os containers est√£o rodando? `docker compose ps`
2. A porta 5173 est√° livre? `lsof -i :5173`
3. Tente acessar: `http://127.0.0.1:5173`

### üì± Testando em Diferentes Dispositivos

**Desktop/Notebook:**
- Acesse: `http://localhost:5173`
- Teste redimensionar a janela (os gr√°ficos devem se adaptar)

**Mobile (mesmo WiFi):**
- Descubra seu IP: `ifconfig | grep inet`
- Acesse: `http://SEU_IP:5173`
- Exemplo: `http://192.168.1.100:5173`

### üé® Personalizando para Teste

**Quer ver dados diferentes?**
```bash
# Limpar dados atuais
docker compose exec mongo mongosh log-dashboard --eval "db.logs.deleteMany({})"

# Criar novos dados
docker compose exec api npm run seed:logs

# Recarregar a p√°gina no navegador (F5)
```

### Dados Fict√≠cios Inclu√≠dos
O comando `seed:logs` cria:
- **~1000 logs** com diferentes n√≠veis (error, warn, info, debug)
- **Per√≠odo de 7 dias** com timestamps variados
- **Mensagens realistas** de erro e informa√ß√µes
- **C√≥digos de erro** diversos (DB_CONN_001, AUTH_002, etc.)
- **Contextos variados** com dados adicionais

### Limpando Dados de Teste
```bash
# Limpar todos os logs (cuidado!)
docker compose exec mongo mongosh log-dashboard --eval "db.logs.deleteMany({})"

# Verificar se foi limpo
docker compose exec mongo mongosh log-dashboard --eval "db.logs.countDocuments()"
```

### Testando Ingest√£o de Logs
```bash
# Testar ingest√£o de logs locais
docker compose exec api npm run ingest

# Verificar logs de ingest√£o
docker compose logs api | grep "ingest"
```

### Testando Conex√£o SSH
```bash
# Testar conex√£o SSH (se configurado)
docker compose exec api npm run test:ssh

# Ver logs de conex√£o SSH
docker compose logs api | grep "ssh"
```

### Verificando Health Checks
```bash
# Health check da API
curl http://localhost:3000/health

# Health check do MongoDB
docker compose exec mongo mongosh --eval "db.adminCommand('ping')"

# Verificar status dos containers
docker compose ps
```

### Testando Endpoints da API
```bash
# Testar endpoint de top errors
curl "http://localhost:3000/stats/top-errors?limit=5"

# Testar time series (√∫ltimas 24h)
curl "http://localhost:3000/stats/time-series?bucket=hour&from=2024-01-01&to=2024-01-02"

# Testar distribui√ß√£o por n√≠veis
curl "http://localhost:3000/stats/levels?from=2024-01-01&to=2024-01-02"

# Testar com par√¢metros espec√≠ficos
curl "http://localhost:3000/stats/top-errors?from=2024-01-01&to=2024-01-31&limit=10"
```

### Exemplo de Dados Fict√≠cios
Ap√≥s executar `seed:logs`, voc√™ ver√° dados como:

```json
{
  "timestamp": "2024-01-15T10:30:00.000Z",
  "level": "error",
  "message": "Database connection failed",
  "source": "api-server",
  "errorCode": "DB_CONN_001",
  "context": {
    "retryCount": 3,
    "timeout": 5000
  }
}
```

### Workflow de Teste Completo
1. **Inicie o projeto**:
   ```bash
   cd docker
   docker compose up -d
   ```

2. **Popule com dados fict√≠cios**:
   ```bash
   docker compose exec api npm run seed:logs
   ```

3. **Teste a API**:
   ```bash
   curl http://localhost:3000/health
   curl "http://localhost:3000/stats/top-errors?limit=5"
   ```

4. **Acesse o Dashboard**: http://localhost:5173

5. **Teste os gr√°ficos**: Use os filtros e veja os dados sendo atualizados

## üìä Endpoints da API

### Health Check
- `GET /health` - Status da aplica√ß√£o

### Estat√≠sticas
- `GET /stats/top-errors?from=&to=&limit=10` - Top erros
- `GET /stats/time-series?bucket=hour|day&from=&to=` - S√©rie temporal
- `GET /stats/levels?from=&to=` - Distribui√ß√£o por n√≠veis

## üß™ Desenvolvimento Local

### Backend
```bash
cd backend
npm install
npm run dev
```

### Frontend
```bash
cd frontend
npm install
npm run dev
```

## üìÅ Estrutura do Projeto

```
log-dashboard/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/Log.ts          # Modelo MongoDB com TTL
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logIngest.ts       # Ingest√£o com valida√ß√£o Zod
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sshFetch.ts        # Fetch remoto via SSH
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/stats.ts        # Endpoints da API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/logger.ts          # Logger JSON (Pino)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts               # Servidor Express
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/Dashboard.tsx    # P√°gina principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/charts/     # Componentes de gr√°ficos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/client.ts          # Cliente da API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hooks/useStats.ts      # Hooks SWR
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml         # Orquestra√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ mongo-init/init.js         # Script de inicializa√ß√£o
‚îî‚îÄ‚îÄ reports/sql/                   # Queries SQL de exemplo
```

## üîß Configura√ß√£o SSH

1. Gere uma chave SSH:
```bash
ssh-keygen -t rsa -b 4096 -f ~/.ssh/log-dashboard
```

2. Configure a chave no servidor remoto:
```bash
ssh-copy-id -i ~/.ssh/log-dashboard.pub user@remote-server
```

3. Defina permiss√µes:
```bash
chmod 600 ~/.ssh/log-dashboard
```

4. Configure no `.env`:
```env
SSH_KEY_PATH=/home/user/.ssh/log-dashboard
```

## üìà Gr√°ficos Dispon√≠veis

1. **Top Errors**: Gr√°fico de barras dos erros mais frequentes
2. **Levels Distribution**: Gr√°fico de pizza da distribui√ß√£o por n√≠veis
3. **Time Series**: Gr√°fico de linha com s√©rie temporal

## üìä Estrutura dos Dados

### Formato de Log
```json
{
  "timestamp": "2024-01-15T10:30:00.000Z",
  "level": "error",
  "message": "Database connection failed",
  "source": "api-server",
  "errorCode": "DB_CONN_001",
  "context": {
    "retryCount": 3,
    "timeout": 5000
  }
}
```

### N√≠veis de Log
- `error`: Erros cr√≠ticos
- `warn`: Avisos
- `info`: Informa√ß√µes
- `debug`: Debug

## üîí Seguran√ßa

- Nunca commite arquivos `.env` ou chaves SSH
- Use HTTPS em produ√ß√£o
- Configure firewall adequadamente
- Rotacione chaves SSH regularmente

## üêõ Troubleshooting

### Containers n√£o iniciam
```bash
# Verificar se as portas est√£o livres
lsof -i :3000
lsof -i :5173
lsof -i :27017

# Verificar logs de erro
docker compose logs
```

### MongoDB n√£o conecta
```bash
docker compose logs mongo
docker compose exec mongo mongosh --eval "db.adminCommand('ping')"
```

### API n√£o responde
```bash
# Verificar se MongoDB est√° rodando
docker compose exec mongo mongosh --eval "db.adminCommand('ping')"

# Verificar logs da API
docker compose logs api

# Testar health check
curl http://localhost:3000/health
```

### Frontend n√£o carrega
```bash
# Verificar se API est√° acess√≠vel
curl http://localhost:3000/health

# Verificar logs do frontend
docker compose logs web

# Testar acesso direto
curl http://localhost:5173
```

### Problemas com SSH
```bash
# Testar conex√£o SSH
npm run test:ssh

# Verificar configura√ß√£o SSH
cat ~/.ssh/config

# Testar com op√ß√µes de compatibilidade
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedAlgorithms=+ssh-rsa user@host
```

## üìù Licen√ßa

Minha licen√ßa - Se tiver d√∫vidas, entre em contato.
